
generator client {
  provider      = "prisma-client-js"
  engineType    = "binary"
  schemas       = ["auth", "public"]
  binaryTargets = ["native", "debian-openssl-1.1.x", "debian-openssl-3.0.x"]
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model profiles {
  id                      String      @id @default(dbgenerated("gen_random_uuid()"))
  user_id                 String      @unique @db.Uuid
  first_name              String
  paternal_last_name      String
  maternal_last_name      String?
  email                   String      @unique
  role                    String      @default("client")
  status                  String      @default("pendiente")
  plan_status             String      @default("sin-plan")
  kalicode                String?     @unique // Changed from invite_code
  avatar_url              String?
  custom_plan_request     String?     @default("none")
  plan_start_date         DateTime?
  plan_end_date           DateTime?
  current_week            Int?
  plan_duration_in_weeks  Int?
  registered_at           DateTime    @default(now())
  auth_users              auth_users  @relation(fields: [user_id], references: [id], onDelete: Cascade)
  onboarding_data         onboarding_data?
  training_plans          training_plans[]
  workout_progress        workout_progress[]
  plan_history            plan_history[]
}

model onboarding_data {
  id                      String    @id @default(dbgenerated("gen_random_uuid()"))
  user_id                 String    @unique @db.Uuid
  goals                   String[]
  currentFitnessLevel     String
  trainingDays            String[]
  trainingTimePerDay      String
  preferredWorkoutStyle   String
  muscleFocus             String[]
  age                     Int
  weight                  Int
  height                  Int
  goalTerm                String
  planDuration            Int
  injuriesOrConditions    String?
  exercisesPerDay         Int
  profiles                profiles  @relation(fields: [user_id], references: [user_id], onDelete: Cascade)
}

model training_plans {
  id                      String    @id @default(dbgenerated("gen_random_uuid()"))
  user_id                 String    @db.Uuid
  plan_data               Json
  is_active               Boolean   @default(true)
  created_at              DateTime  @default(now())
  profiles                profiles  @relation(fields: [user_id], references: [user_id], onDelete: Cascade)
}

model workout_progress {
  user_id                 String    @db.Uuid
  week                    Int
  progress_data           Json
  updated_at              DateTime  @default(now())
  profiles                profiles  @relation(fields: [user_id], references: [user_id], onDelete: Cascade)

  @@id([user_id, week])
}

model plan_history {
  id                      String    @id @default(dbgenerated("gen_random_uuid()"))
  user_id                 String    @db.Uuid
  plan_data               Json
  created_at              DateTime  @default(now())
  profiles                profiles  @relation(fields: [user_id], references: [user_id], onDelete: Cascade)
}

model auth_users {
  id                    String      @unique @db.Uuid
  raw_user_meta_data    Json?
  profiles              profiles[]
}

